<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>OpenTelemetry on もざぶれなるままに</title>
        <link>http://localhost:1313/tags/opentelemetry/</link>
        <description>Recent content in OpenTelemetry on もざぶれなるままに</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>ja-jp</language>
        <lastBuildDate>Fri, 27 Feb 2026 10:33:52 +0900</lastBuildDate><atom:link href="http://localhost:1313/tags/opentelemetry/index.xml" rel="self" type="application/rss+xml" /><item>
            <title>Observability パイプライン構築ガイド</title>
            <link>http://localhost:1313/blog/observability-pipelines/</link>
            <pubDate>Fri, 27 Feb 2026 10:33:52 +0900</pubDate>
            <guid>http://localhost:1313/blog/observability-pipelines/</guid>
            <description>&lt;h2 id=&#34;なぜパイプラインが必要なのか&#34;&gt;なぜパイプラインが必要なのか&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;クラウド化とマイクロサービス化に伴い、各サービスはメトリクス・ログ・トレースを膨大に生成します。ツールごとにエージェントを配置していると、&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;収集経路が乱立し障害点が特定しづらい&lt;/li&gt;&#xA;&lt;li&gt;ライセンス課金の上昇（特にログ）&lt;/li&gt;&#xA;&lt;li&gt;収集フォーマットが統一されずデータの再利用が難しい&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;といった問題が顕在化します。OpenTelemetry Collector を中心にした observability pipeline を構築すると、収集〜整形〜配信の制御を1箇所に集約できます。&lt;/p&gt;&#xA;&lt;h2 id=&#34;最小構成のアーキテクチャ&#34;&gt;最小構成のアーキテクチャ&#xD;&#xA;&lt;/h2&gt;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;[App] --(OTLP/HTTP)--&amp;gt; [Agent Collector] --(OTLP/gRPC)--&amp;gt; [Gateway Collector] -- fan-out --&amp;gt; [Datadog][Grafana LGTM][S3]&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Agent Collector&lt;/strong&gt;: 各ノードにデプロイし、アプリ側の exporter と密結合を避ける。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Gateway Collector&lt;/strong&gt;: VPC 内の1〜数台で受け口を集約し、キューやバッファを持たせる。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;Backend&lt;/strong&gt;: SaaS/APM + OSS (Loki, Tempo など) を用途別に使い分ける。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;opentelemetry-collector-の設定例&#34;&gt;OpenTelemetry Collector の設定例&#xD;&#xA;&lt;/h2&gt;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;receivers&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;otlp&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;protocols&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;http&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;grpc&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;processors&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;batch&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;memory_limiter&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;check_interval&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;5s&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;limit_mib&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;512&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;attributes&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;actions&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      - &lt;span style=&#34;color:#f92672&#34;&gt;key&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;environment&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;value&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;prod&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;action&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;upsert&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;exporters&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;loki&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;endpoint&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;https://logs.example.com/loki/api/v1/push&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;otlp/datadog&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;endpoint&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;https://api.datadoghq.com&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;headers&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;DD-API-KEY&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;${DATADOG_API_KEY}&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;service&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;pipelines&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;logs&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;receivers&lt;/span&gt;: [&lt;span style=&#34;color:#ae81ff&#34;&gt;otlp]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;processors&lt;/span&gt;: [&lt;span style=&#34;color:#ae81ff&#34;&gt;memory_limiter, batch, attributes]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;exporters&lt;/span&gt;: [&lt;span style=&#34;color:#ae81ff&#34;&gt;loki, otlp/datadog]&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;上記の &lt;code&gt;attributes&lt;/code&gt; プロセッサで環境タグを付与しておくと、ダッシュボードのフィルタリングが容易になります。&lt;code&gt;memory_limiter&lt;/code&gt; は Collector 自体の OOM を防ぐので、本番では必須です。&lt;/p&gt;&#xA;&lt;h2 id=&#34;運用時の観点&#34;&gt;運用時の観点&#xD;&#xA;&lt;/h2&gt;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;バックプレッシャー制御&lt;/strong&gt;: エクスポーターごとにリトライやキュー長の上限を設定し、停止時のロストを最小化します。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;スキーマ互換性&lt;/strong&gt;: OpenTelemetry Schema 1.0 以降でフィールド名が変わるケースがあるので、&lt;code&gt;otelcol --version&lt;/code&gt; と schema URL を定期的に確認します。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;コストガードレール&lt;/strong&gt;: ログの sampling を Collector 側で実装し、一定以上のトラフィックが来た場合は重要タグを含むものだけを通すなど安全装置を持たせます。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;構成のテスト自動化&lt;/strong&gt;: Collector の設定は単なる YAML なので、&lt;code&gt;otelcol --config config.yaml --dry-run&lt;/code&gt; を CI で回すと人為的な typo を早期に検知できます。&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 id=&#34;データ品質向上の-tips&#34;&gt;データ品質向上の Tips&#xD;&#xA;&lt;/h2&gt;&lt;ul&gt;&#xA;&lt;li&gt;&lt;strong&gt;Semantic Conventions の準拠&lt;/strong&gt;: HTTP サービスなら &lt;code&gt;http.method&lt;/code&gt;, &lt;code&gt;http.route&lt;/code&gt; など必須属性を埋めることで、可視化ツール側の自動集計が機能します。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;メタデータの enrich&lt;/strong&gt;: デプロイ情報（Git SHA、k8s namespace）を Collector 側で付与すると、アプリ改修との相関が取りやすい。&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;PII 対策&lt;/strong&gt;: &lt;code&gt;filter&lt;/code&gt; プロセッサで個人情報をマスキングし、誤送信を防ぐ。&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;h2 id=&#34;まとめ&#34;&gt;まとめ&#xD;&#xA;&lt;/h2&gt;&lt;p&gt;Observability pipeline は単にテレメトリデータを転送する装置ではなく、SLO を守るための制御点です。Collector を中心に据えた構成であれば、&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;データの正規化&lt;/li&gt;&#xA;&lt;li&gt;コスト最適化&lt;/li&gt;&#xA;&lt;li&gt;配信先の抽象化&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;p&gt;を同時に実現できます。まずはステージングで Collector を 1 本立て、既存の APM からのルーティングを段階的に切り替えるところから始めてみてください。&lt;/p&gt;&#xA;</description>
        </item></channel>
</rss>
